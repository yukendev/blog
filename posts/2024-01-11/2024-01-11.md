---
title: 'Google Calendarã‹ã‚‰äºˆå®šã‚’å–å¾—ã—ã¦LINEã§è‡ªå‹•ã§ãƒªãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹'
date: '2024-01-11'
slug: 'tips-google-calendar-line-reminder'
category: 'tech'
tags:
  - 'JavaScript'
  - 'Node.js'
description: 'æ¯é€±æœˆæ›œæ—¥ã«Google Calendarã‹ã‚‰1é€±é–“ã®äºˆå®šã‚’å–å¾—ã—ã¦ãã¦ã€è‡ªå‹•ã§LINEã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã«ãœã²æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚'
---


# ã‚„ã‚ŠãŸã„ã“ã¨

æ¯é€±æœˆæ›œæ—¥ã®æœã«ã€ä»Šé€±ã®äºˆå®šã‚’Google Calendarã‹ã‚‰å–å¾—ã—ã¦ã€ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«LINEã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ãŸã„ã€‚

<img src="@image/line.png">

# åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹

- [Google API](https://developers.google.com/calendar/api/guides/overview?hl=ja): Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰äºˆå®šã‚’å–å¾—ã™ã‚‹
- [LINE API](https://developers.line.biz/ja/services/messaging-api/): LINEã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹
- [Render.com](https://render.com/): æ¯é€±æœˆæ›œæ—¥ã®æœã«å®šæœŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹

ãã‚Œãã‚Œå€‹åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã§ã‚ˆã‹ã£ãŸã‚‰ã€èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚ä»Šå›ã¯ãã‚Œã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ãŸå¿…æ®ºæŠ€ã§ã™ã€‚

- [Google APIã‚’åˆ©ç”¨ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰äºˆå®šã‚’å–å¾—ã™ã‚‹]([https://www.yukendev.com/blogs/](https://www.yukendev.com/blogs/tips-line-api)https://www.yukendev.com/blogs/tips-googleapi-calendar)
- [LINE APIã‚’åˆ©ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹](https://www.yukendev.com/blogs/tips-line-api)
- [Render.comã‚’ç”¨ã„ã¦å®šæœŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹]([https://www.yukendev.com/blogs/](https://www.yukendev.com/blogs/tips-line-api)tips-render-com-cron-job)

# å®Œæˆã—ãŸã‚³ãƒ¼ãƒ‰

https://github.com/yukendev/shin.jing.rui-bot

## ãƒã‚¤ãƒ³ãƒˆ

ä»¥ä¸‹ã¯ã€æ¯é€±æœˆæ›œæ—¥ã®åˆå‰9æ™‚åŠã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰

```tsx:hogehoge
import { getEventListFromGoogleCalendar } from "../api/google.js";
import { sendLineMessage } from "../api/line.js";
import dotenv from "dotenv";
import { parseCalendarEvent, parseToLineMessage } from "../utils/calendar.js";
import dayjs from "dayjs";

/*
   æ—¥æœ¬æ™‚é–“ã§æ¯é€±æœˆæ›œæ—¥ã®åˆå‰ï¼™æ™‚åŠã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¸ãƒ§ãƒ–
 */
dotenv.config();

const myId = process.env.YUKEN_LINE_ID; // è‡ªåˆ†ã®LINEã®ID
const shinjingruiGroupId = process.env.SHINJINGRUI_LINE_GROUP_ID; // ã‚°ãƒ«ãƒ¼ãƒ—ã®LINEã®ID

const sendGoogleCalendarEvents = async () => {
  const minDate = dayjs().set("hour", 0).set("minute", 0); // ä»Šæ—¥ã®00æ™‚00åˆ†
  const maxDate = minDate.add(7, "d").set("hour", 23).set("minute", 59); // 1é€±é–“å¾Œã®23æ™‚59åˆ†

  try {
		// ä»Šæ—¥ã®00æ™‚00åˆ†ã‹ã‚‰1é€±é–“å¾Œã®23æ™‚59åˆ†ã¾ã§ã®äºˆå®šã‚’å–å¾—
    const result = await getEventListFromGoogleCalendar(
      minDate.format(),
      maxDate.format()
    );

    if (!result) return;

    const parsedData = parseCalendarEvent(result);
    const lineMessage = parseToLineMessage(parsedData);

    if (shinjingruiGroupId !== undefined) {
      sendLineMessage(
        shinjingruiGroupId,
        "ä»Šé€±ã®äºˆå®šã§ã™ï¼ä»Šé€±ã‚‚ã‚†ã£ãã‚Šé ‘å¼µã‚Šã¾ã—ã‚‡ã†ğŸˆâ€â¬›"
      );
      sendLineMessage(shinjingruiGroupId, lineMessage);
    }
  } catch (err) {
    if (myId !== undefined) {
      sendLineMessage(myId, "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸğŸš¨");
    }
  }
};

sendGoogleCalendarEvents();
```

ä»¥ä¸‹ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®äºˆå®šå–å¾—éƒ¨åˆ†ã§ã™ã€‚è©³ã—ãã¯[åˆ¥ã®è¨˜äº‹]([https://www.yukendev.com/blogs/](https://www.yukendev.com/blogs/tips-line-api)https://www.yukendev.com/blogs/tips-googleapi-calendar)ã§è§£èª¬ã—ã¦ã„ã¾ã™ãŒã€googleã®apiã‚’åˆ©ç”¨ã—ã¦ã€æŒ‡å®šã•ã‚ŒãŸç¯„å›²ã®äºˆå®šä¸€è¦§ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```tsx
import dotenv from "dotenv";
import { google } from "googleapis";

dotenv.config();

const clientId = process.env.GOOGLE_OAUTH_CLIENT_ID;
const clientSecret = process.env.GOOGLE_OAUTH_CLIENT_SECRET;
const refreshToken = process.env.GOOGLE_OAUTH_REFRESH_TOKEN;
const calendarId = process.env.CALENDAR_ID;

const getGoogleOAuth = async () => {
  const googleOAuth = new google.auth.OAuth2(
    clientId,
    clientSecret,
    "http://localhost"
  );

  // æ¯å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«æ–°ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
  googleOAuth.setCredentials({
    refresh_token: refreshToken,
  });

  try {
    const accessTokenResponse = await googleOAuth.getAccessToken();

    const accessToken = accessTokenResponse.token;

    if (!accessToken)
      throw new Error("æœ‰åŠ¹ãªã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ");

    googleOAuth.setCredentials({
      access_token: accessToken,
    });

    return googleOAuth;
  } catch (err) {
    console.log("ã‚¨ãƒ©ãƒ¼ã®ä¸­èº«", err);
    throw new Error("ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
  }
};

/**
 * @param timeMin new Date().toISOString() etc...
 * @param timeMax new Date().toISOString() etc...
 */
export const getEventListFromGoogleCalendar = async (
  timeMin: string,
  timeMax: string
) => {
  try {
    const googleOAuth = await getGoogleOAuth();
    const calendar = google.calendar({ version: "v3", auth: googleOAuth });
    const res = await calendar.events.list({
      calendarId,
      timeMin,
      timeMax,
      timeZone: "Asia/Tokyo",
    });
    if (!res.data.items)
      throw new Error("æ­£å¸¸ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ");
    const events = res.data.items.reverse();
    return events;
  } catch (err) {
    console.log("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", err);
  }
};
```

ä»¥ä¸‹ã¯Render.comã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ç”¨ã®`render.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

```yaml
services:
  # æ—¥æœ¬æ™‚é–“ã®æ¯é€±åœŸæ›œæ—¥ã®åˆå‰9æ™‚30åˆ†ã«å®Ÿè¡Œ
  - type: cron
    name: saturday job
    runtime: node
    schedule: "30 0 * * 6"
    buildCommand: pnpm install && pnpm run build
    startCommand: pnpm run job:saturday
    region: singapore

  # æ—¥æœ¬æ™‚é–“ã®æ¯é€±æœˆæ›œæ—¥ã®åˆå‰9æ™‚30åˆ†ã«å®Ÿè¡Œ
  - type: cron
    name: monday job
    runtime: node
    schedule: "30 0 * * 1"
    buildCommand: pnpm install && pnpm run build
    startCommand: pnpm run job:monday
    region: singapore

  # æ—¥æœ¬æ™‚é–“ã®æ¯æœˆ1æ—¥ã®åˆå¾Œ12æ™‚ã«å®Ÿè¡Œ
  - type: cron
    name: monthly job
    runtime: node
    schedule: "0 3 1 * *"
    buildCommand: pnpm install && pnpm run build
    startCommand: pnpm run job:monthly
    region: singapore
```

ä»Šå›ã®äºˆå®šã‚’å–å¾—ã—ã¦LINEã§é€šçŸ¥ã™ã‚‹ä»¥å¤–ã®å®šæœŸå‡¦ç†ã®è¨­å®šã‚‚å…¥ã£ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã§`Render.com`ã«ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# å®Œæˆï¼

<img src="@image/line.png">

ã“ã‚Œã§ã“ã‚“ãªæ„Ÿã˜ã®LINEãŒæ¯é€±æœˆæ›œã«è‡ªå‹•çš„ã«é€ä¿¡ã•ã‚Œã¾ã™ï¼ãƒãƒƒãƒ”ãƒ¼ï¼

# æœ€å¾Œã«

è‡ªåˆ†ã§ä½œã£ãŸã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿéš›ã«èº«è¿‘ãªã¨ã“ã‚ã§å‹•ã„ã¦ã€å½¹ã«ç«‹ã£ã¦ã„ã‚‹ã¨å¬‰ã—ã„ã§ã™ã­ã€‚

ã§ã¯

Bye